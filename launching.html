<!DOCTYPE html>
<html lang="en">
<head>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>嫦娥六號發射模擬器 | Chang'e-6 Launch Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(to bottom, #000000 0%, #000033 100%);
            color: white;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            background: #000;
            perspective: 1000px; /* Add perspective for 3D effect */
        }
        
        #game-container {
            flex: 1;
            position: relative;
            width: 100%;
            height: 100%;
            perspective: 1000px;
            overflow: hidden;
        }
        
        #rocket-container {
            position: absolute;
            width: 100%;
            height: 100%;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            transition: transform 2.5s ease-out; /* 缩短过渡时间 */
        }
        
        .rocket {
            position: relative;
            width: 200px;
            height: 600px;
            transform-style: preserve-3d;
            transform: rotateX(-10deg);
            bottom: -300px;
            transition: bottom 5s ease-out, transform 2s; /* 缩短过渡时间 */
        }
        
        .fairing {
            position: absolute;
            width: 80px;
            height: 120px;
            background: linear-gradient(to bottom, #ffffff 0%, #f8f4ed 100%);
            left: 60px;
            top: 0;
            border-radius: 40px 40px 0 0;
            transform-origin: bottom center;
            transition: all 1s;
        }
        
        .fairing.left {
            clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%);
        }
        
        .fairing.right {
            clip-path: polygon(50% 0, 100% 0, 100% 100%, 50% 100%);
        }
        
        .fairing.detached-left {
            transform: translateX(-100px) rotateZ(-30deg);
            opacity: 0;
        }
        
        .fairing.detached-right {
            transform: translateX(100px) rotateZ(30deg);
            opacity: 0;
        }
        
        .payload {
            position: absolute;
            background: linear-gradient(to bottom, #ffffff 0%, #e1dacf 100%);
            left: 65px;
            top: 20px;
            opacity: 0;
            transition: opacity 1s, transform 2s;
        }
        /* 上部较小的正方体 */
.payload::before {
    content: "";
    position: absolute;
    width: 40px;
    height: 30px;
    background: #ede8dd;
    top: 35px;
    left: 15px;
    border-radius: 5px;
}

/* 下部较大的正方体 */
.payload::after {
    content: "";
    position: absolute;
    width: 60px;
    height: 35px;
    background: #ede8dd;
    bottom: -100px;
    left: 5px;
    border-radius: 5px;
}
        .payload.visible {
            opacity: 1;
        }
        
        .payload.separated {
            transform: translateY(-200px);
        }
        
        .second-stage {
            position: absolute;
            width: 80px;
            height: 100px;
            background: linear-gradient(to bottom, #f8f4ed 0%, #ece7df 100%);
            left: 60px;
            top: 120px;
        }
.second-stage::before {
    content: "";
    position: absolute;
    width: 60px;
    height: 60px;
    background-image: url('https://i.postimg.cc/nMQNH4jv/China-Aerospace-Science-and-Technology-Corporation.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    top: 20px; /* 调整这个值可以改变图片在二级火箭上的垂直位置 */
    left: 10px;
    z-index: 1;
}

        
        .first-stage {
    position: absolute;
    width: 80px;
    height: 300px;
     background: linear-gradient(to bottom, #ece7df 50%, #d9d2c5 100%);
    left: 60px;
    top: 220px;
    transition: all 1s;
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* 改为从顶部开始排列 */
    justify-content: center;
    align-items: center;
    padding-top: 30px; /* 顶部内边距，让内容更靠上 */
        }
        
.first-stage::after {
    content: "中国航天";
    writing-mode: vertical-rl;
    letter-spacing: 5px;
    font-size: 16px;
    font-weight: bold;
    color: #272833; /* 蓝色文字 */
    text-shadow: 0 0 2px rgba(3,3,131,0.8);
    margin-bottom: 10px; /* 为logo留出空间 */
}
.first-stage::before {
    content: "";
    position: absolute;
    width: 50px;
    height: 50px;
    background-image: url('https://i.postimg.cc/cgD32tZC/Long-March-5-Logo.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    top: 80px; /* 调整logo位置 */
    left: 15px;
    z-index: 1;
}
.first-stage .flame {
    bottom: -10px; /* 保持火焰在底部 */
}
        .first-stage.detached {
            transform: translateY(100px);
            opacity: 0;
        }
        
        .booster {
            position: absolute;
            width: 50px;
            height: 250px;
            background: linear-gradient(to bottom, #f8f4ed 0%, #d9d2c5 100%);
            top: 300px;
            border-radius: 20px 20px 0 0;
            transition: all 1s;
        }
        
        .booster.left-front {
            left: 8px;
        }
        
        .booster.right-front {
            left: 142px;
        }
        
        .booster.left-back {
            left: 8px;
            transform: translateZ(-10px);
        }
        
        .booster.right-back {
            left: 142px;
            transform: translateZ(-10px);
        }
        
        .booster.detached-left-front {
            transform: translateX(-100px) rotateZ(-20deg);
            opacity: 0;
        }
        
        .booster.detached-right-front {
            transform: translateX(100px) rotateZ(20deg);
            opacity: 0;
        }
        
        .booster.detached-left-back {
            transform: translateZ(-10px) translateX(-100px) rotateZ(-20deg);
            opacity: 0;
        }
        
        .booster.detached-right-back {
            transform: translateZ(-10px) translateX(100px) rotateZ(20deg);
            opacity: 0;
        }
        
        .engine {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #333333;
            border-radius: 50%;
            bottom: -10px;
            transform: translateX(-10px);
        }
        
        .first-stage .engine {
            left: 10px;
        }
        
        .first-stage .engine:nth-child(2) {
            left: 30px;
        }
        
        .first-stage .engine:nth-child(3) {
            left: 50px;
        }
        
        .first-stage .engine:nth-child(4) {
            left: 70px;
        }
        
        .second-stage .engine {
            left: 10px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .second-stage .engine:nth-child(2) {
            left: 30px;
        }
        
        .second-stage .engine:nth-child(3) {
            left: 50px;
        }
        
        .second-stage .engine:nth-child(4) {
            left: 70px;
        }
        
        .engine.ignited {
            box-shadow: 0 0 20px 10px rgba(255, 165, 0, 0.8);
        }
        
        .flame {
            position: absolute;
            width: 50px;
            height: 0;
            background: linear-gradient(to bottom, rgba(255, 165, 0, 0.8) 0%, rgba(255, 69, 0, 0.6) 60%, rgba(255, 255, 0, 0.4) 100%);
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%) translateY(120px) rotateX(180deg);
            border-radius: 50% 50% 20% 20%;
            transition: height 1s;
        }
        
        .flame.active {
            height: 150px;
            animation: flicker 0.1s infinite alternate;
        }
        
        @keyframes flicker {
            0% { height: 120px; opacity: 0.9; }
            100% { height: 150px; opacity: 1; }
        }
        
        
        .prompt-container {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 100;
            min-width: 300px;
            border: 2px solid #1a73e8;
            box-shadow: 0 4px 6px rgba(0, 100, 255, 0.8);
        }
        
        .prompt-text {
            font-size: 24px;
            margin-bottom: 20px;
            color: white;
            font-weight: 500;
        }
        
        .ignition-button {
            padding: 10px 20px;
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            min-width: 100px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 100, 255, 0.8);
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
        }
        
        .ignition-button:hover {
            background-color: #1557b0;
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0, 135, 255, 0.6);
        }
        
        .progress-container {
            position: absolute;
            bottom: 30px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            width: auto;
            max-width: 300px;
            border: 2px solid #1a73e8;
            box-shadow: 0 4px 6px rgba(0, 100, 255, 0.8);
        }
        
        .progress-step {
            margin: 5px 0;
            color: #999;
            font-size: 14px;
            text-align: left;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
        }
        
        .progress-step.active {
            color: #1a73e8;
            font-weight: bold;
            background-color: rgba(26, 115, 232, 0.1);
            border-left: 3px solid #1a73e8;
        }
        
        .progress-step.completed {
            color: #00cc00;
            background-color: rgba(0, 204, 0, 0.1);
            border-left: 3px solid #00cc00;
        }
        
        .altitude-container {
            position: absolute;
            bottom: 30px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 100;
            text-align: center;
            border: 2px solid #1a73e8;
            box-shadow: 0 4px 6px rgba(0, 100, 255, 0.8);
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
        }
        
        #altitude-value {
            font-size: 24px;
            font-weight: bold;
            color: #1a73e8;
            margin-top: 5px;
        }
        
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            color: #ff3300;
            z-index: 200;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 51, 0, 0.8);
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .countdown.visible {
            opacity: 1;
        }
        
        .scene-transition {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 150;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }
        
        .scene-transition.active {
            opacity: 1;
        }
        
        .earth-backdrop {
            position: absolute;
            bottom: -500px;
            left: 0;
            width: 150%;
            height: 500px;
            background: radial-gradient(ellipse at center, #1a3a8a 0%, #000033 100%);
            border-radius: 50% 50% 0 0;
            transform: translateX(-25%);
            transition: bottom 2.5s ease-out; /* 缩短过渡时间 */
        }
        
        .earth-backdrop.fade-away {
            bottom: -800px;
        }
        
        .mission-complete, .mission-failed {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            z-index: 300;
            max-width: 80%;
            display: none;
            border: 2px solid #1a73e8;
            box-shadow: 0 4px 6px rgba(0, 100, 255, 0.8);
        }
        
        .mission-complete h2, .mission-failed h2 {
            font-size: 36px;
            margin-bottom: 20px;
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
        }
        
        .mission-complete p, .mission-failed p {
            font-size: 18px;
            margin-bottom: 20px;
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
        }
        
        .restart-button {
            padding: 10px 20px;
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            min-width: 100px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 100, 255, 0.8);
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
            margin: 0 auto;
        }
        
        .restart-button:hover {
            background-color: #1557b0;
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0, 135, 255, 0.6);
        }
        
        .flight-indicator {
            position: absolute;
            width: 100%;
            z-index: 50;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s;
        }
        
        .flight-indicator.active {
            opacity: 1;
        }
        
        .flight-indicator .star {
            position: absolute;
            width: 3px;
            height: 3px;
            background-color: white;
            border-radius: 50%;
            animation: star-motion 3s linear infinite;
        }
        
        .spacecraft-focus {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            z-index: 200;
            opacity: 0;
            transition: opacity 2s;
        }
        
        .spacecraft-focus.visible {
            opacity: 1;
        }
        
        .spacecraft-model {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #999999 0%, #666666 100%);
            border-radius: 50px 50px 0 0;
            position: relative;
            transform: scale(1.5);
            animation: float 5s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: scale(1.5) translateY(0); }
            50% { transform: scale(1.5) translateY(-10px); }
        }
        
        .solar-panel {
            position: absolute;
            height: 20px;
            background: linear-gradient(to bottom, #3366cc 0%, #0033cc 100%);
            top: 40px;
        }
        
        .solar-panel.left {
            width: 60px;
            left: -70px;
        }
        
        .solar-panel.right {
            width: 60px;
            right: -70px;
        }
        
        .antenna {
            position: absolute;
            width: 5px;
            height: 40px;
            background: #cccccc;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .dish {
            position: absolute;
            width: 25px;
            height: 25px;
            background: #ffffff;
            border-radius: 50%;
            top: -30px;
            left: 50%;
            transform: translateX(-50%) rotate(-45deg);
        }
        
        /* 可交互区域样式 */
        .clickable {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.1);
            z-index: 10;
            border-radius: 5px;
            cursor: default; /* 默认不显示pointer */
            transition: all 0.3s;
            opacity: 0; /* 默认隐藏 */
            pointer-events: none; /* 默认不可交互 */
        }
        
        .clickable.active {
            opacity: 1;
            pointer-events: auto;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: pulse-area 2s infinite;
        }
        
        @keyframes pulse-area {
            0% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.8); }
            100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
        }
        
        .booster-click-area {
            width: 70px;
            height: 280px;
        }
        
        .booster-click-area.left-front {
            left: -2px;
            top: 290px;
        }
        
        .booster-click-area.right-front {
            left: 133px;
            top: 290px;
        }
        
        .fairing-click-area {
            width: 120px;
            height: 140px;
            left: 40px;
            top: -10px;
        }
        
        .first-stage-click-area {
            width: 120px;
            height: 320px;
            left: 40px;
            top: 210px;
        }

        .second-stage-click-area {
            width: 80px;
            height: 100px;
            left: 60px;
            top: 120px;
        }
        
        .payload-click-area {
            width: 100px;
            height: 80px;
            left: 50px;
            top: 45px;
        }
        
        @keyframes star-motion {
            from { transform: translateY(-100vh); }
            to { transform: translateY(100vh); }
        }
        
        @media (max-width: 768px) {
            .rocket {
                transform: scale(0.7) rotateX(-10deg);
            }
            
            .prompt-text {
                font-size: 18px;
            }
            
            .progress-container, .altitude-container {
                font-size: 14px;
            }
            
            .countdown {
                font-size: 80px;
            }
        }
        
        @media (max-width: 480px) {
            .rocket {
                transform: scale(0.5) rotateX(-10deg);
            }
            
            .prompt-container {
                min-width: 250px;
            }
            
            .prompt-text {
                font-size: 16px;
            }
            
            .countdown {
                font-size: 60px;
            }
        }
        
        .payload-blue-bar {
            position: absolute;
            width: 12px;
            height: 25px;
            background: #0800ad;
            border-radius: 0;
            top: 85px;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 2;
        }
        .payload-blue-bar.left {
            left: -8px; /* 紧贴大矩形左侧 */
            top: 70px;
        }
        .payload-blue-bar.right {
            right: -78px; /* 紧贴大矩形右侧 */
            top: 70px;
        }
        .payload.visible .payload-blue-bar {
            opacity: 1;
        }
    </style>
</head>
<body>
    <audio id="audio-ignition" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b5b6b1b2.mp3"></audio>
    <audio id="audio-flight" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b5b6b1b2.mp3" loop></audio>
    <div id="game-container">
        <div class="stars"></div>
        <div class="earth-backdrop"></div>
        <div class="scene-transition"></div>
        
        <div class="flight-indicator"></div>
        
        <div class="spacecraft-focus">
            <div class="spacecraft-model">
                <div class="antenna"></div>
                <div class="dish"></div>
                <div class="solar-panel left"></div>
                <div class="solar-panel right"></div>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-step step-1 active" data-zh-tw="點火升空" data-en="Ignition and Liftoff">點火升空</div>
            <div class="progress-step step-2" data-zh-tw="助推器分離" data-en="Booster Separation">助推器分離</div>
            <div class="progress-step step-3" data-zh-tw="整流罩分離" data-en="Fairing Separation">整流罩分離</div>
            <div class="progress-step step-4" data-zh-tw="一級火箭分離" data-en="First Stage Separation">一級火箭分離</div>
            <div class="progress-step step-5" data-zh-tw="二級火箭點火" data-en="Second Stage Ignition">二級火箭點火</div>
            <div class="progress-step step-6" data-zh-tw="星箭分離" data-en="Spacecraft Separation">星箭分離</div>
        </div>
        
        <div class="altitude-container">
            <div id="altitude-label" data-zh-tw="時間" data-en="Time">時間: </div>
            <div id="altitude-value">0 s</div>
        </div>
        
        <div class="prompt-container">
            <div class="prompt-text" data-zh-tw="準備發射嫦娥六號任務" data-en="Prepare to launch Chang'e-6 mission">準備發射嫦娥六號任務</div>
            <button class="ignition-button" data-zh-tw="點火" data-en="Ignite">點火</button>
        </div>
        
        <div class="countdown">5</div>
        
        <div id="rocket-container">
            <div class="rocket">
                <!-- 点击区域 -->
                <div class="clickable fairing-click-area" id="fairing-click"></div>
                <div class="clickable booster-click-area left-front" id="booster-click-left"></div>
                <div class="clickable booster-click-area right-front" id="booster-click-right"></div>
                <div class="clickable first-stage-click-area" id="first-stage-click"></div>
                <div class="clickable payload-click-area" id="payload-click"></div>
                
                <!-- 火箭部件 -->
                <div class="fairing left"></div>
                <div class="fairing right"></div>
                <div class="payload">
                    <div class="payload-blue-bar left"></div>
                    <div class="payload-blue-bar right"></div>
                </div>
                <div class="second-stage">
                    <div class="engine"></div>
                    <div class="engine"></div>
                    <div class="engine"></div>
                    <div class="engine"></div>
                </div>
                <div class="first-stage">
                    <div class="engine"></div>
                    <div class="engine"></div>
                    <div class="engine"></div>
                    <div class="engine"></div>
                    <div class="flame"></div>
                </div>
                <div class="booster left-front">
                    <div class="flame"></div>
                </div>
                <div class="booster right-front">
                    <div class="flame"></div>
                </div>
                <div class="booster left-back">
                    <div class="flame"></div>
                </div>
                <div class="booster right-back">
                    <div class="flame"></div>
                </div>
            </div>
        </div>
        
        <div class="mission-complete">
            <h2 data-zh-tw="任務完成！" data-en="Mission Complete!">任務完成！</h2>
            <p data-zh-tw="嫦娥六號成功進入軌道" 
               data-en="Chang'e-6 has successfully entered orbit">
                嫦娥六號成功進入軌道
            </p>
            <button class="restart-button" data-zh-tw="重新開始" data-en="Restart">重新開始</button>
        </div>
        
        <div class="mission-failed">
            <h2 data-zh-tw="任務失敗！" data-en="Mission Failed!">任務失敗！</h2>
            <p data-zh-tw="未能在正確的高度完成分離操作" 
               data-en="Failed to complete separation at the correct altitude">
                未能在正確的高度完成分離操作
            </p>
            <button class="restart-button" data-zh-tw="重新開始" data-en="Restart">重新開始</button>
        </div>
    </div>

    <script>
        // 游戏状态
        let gameState = {
            currentStep: 1,
            altitude: 0,
            language: document.documentElement.lang || 'en',
            rocketLaunched: false,
            countdown: false,
            countdownValue: 5,
            intervalId: null,
            flightMode: false,
            missionTime: 0,
            timeLimits: {
                boosterSeparation: 176.0795,
                fairingSeparation: 326.4445,
                firstStageSeparation: 485.1839,
                secondStageIgnition: 488.1839,
                spacecraftSeparation: 2218.5653
            }
        };
        
        // 元素
        const gameContainer = document.getElementById('game-container');
        const rocketContainer = document.getElementById('rocket-container');
        const rocket = document.querySelector('.rocket');
        const firstStage = document.querySelector('.first-stage');
        const secondStage = document.querySelector('.second-stage');
        const fairingLeft = document.querySelector('.fairing.left');
        const fairingRight = document.querySelector('.fairing.right');
        const payload = document.querySelector('.payload');
        const boosters = document.querySelectorAll('.booster');
        const firstStageEngines = document.querySelectorAll('.first-stage .engine');
        const secondStageEngines = document.querySelectorAll('.second-stage .engine');
        const firstStageFlame = document.querySelector('.first-stage .flame');
        const boosterFlames = document.querySelectorAll('.booster .flame');
        const promptContainer = document.querySelector('.prompt-container');
        const promptText = document.querySelector('.prompt-text');
        const ignitionButton = document.querySelector('.ignition-button');
        const progressSteps = document.querySelectorAll('.progress-step');
        const altitudeValue = document.getElementById('altitude-value');
        const altitudeLabel = document.getElementById('altitude-label');
        const countdown = document.querySelector('.countdown');
        const missionComplete = document.querySelector('.mission-complete');
        const restartButton = document.querySelector('.restart-button');
        const sceneTransition = document.querySelector('.scene-transition');
        const stars = document.querySelector('.stars');
        const earthBackdrop = document.querySelector('.earth-backdrop');
        const flightIndicator = document.querySelector('.flight-indicator');
        const spacecraftFocus = document.querySelector('.spacecraft-focus');
        
        // 点击区域元素
        const boosterClickLeft = document.getElementById('booster-click-left');
        const boosterClickRight = document.getElementById('booster-click-right');
        const fairingClickArea = document.getElementById('fairing-click');
        const firstStageClickArea = document.getElementById('first-stage-click');
        const payloadClickArea = document.getElementById('payload-click');
        
        // 可交互区域列表
        const allClickableAreas = [
            boosterClickLeft,
            boosterClickRight,
            fairingClickArea,
            firstStageClickArea,
            payloadClickArea
        ];
        
        // 文本数据
        const texts = {
            'step-1': {
                'en': 'Ignition and Liftoff',
                'zh': '點火升空'
            },
            'step-2': {
                'en': 'Booster Separation',
                'zh': '助推器分離'
            },
            'step-3': {
                'en': 'Fairing Separation',
                'zh': '整流罩分離'
            },
            'step-4': {
                'en': 'First Stage Separation',
                'zh': '一級火箭分離'
            },
            'step-5': {
                'en': 'Second Stage Ignition',
                'zh': '二級火箭點火'
            },
            'step-6': {
                'en': 'Spacecraft Separation',
                'zh': '星箭分離'
            },
            'prompt-1': {
                'en': 'Prepare to launch Chang\'e-6 mission',
                'zh': '準備發射嫦娥六號任務'
            },
            'prompt-2': {
                'en': 'Rocket is ascending, click on boosters to separate them',
                'zh': '火箭已上升，請點擊助推器進行分離'
            },
            'prompt-3': {
                'en': 'Click on the fairing to separate it',
                'zh': '請點擊整流罩進行分離'
            },
            'prompt-4': {
                'en': 'Click on the first stage rocket to separate it',
                'zh': '請點擊一級火箭進行分離'
            },
            'prompt-5': {
                'en': 'Second stage engine ignition',
                'zh': '二級火箭開始點火'
            },
            'prompt-6': {
                'en': 'Click on Chang\'e-6 for spacecraft separation',
                'zh': '請點擊嫦娥六號進行星箭分離'
            },
            'ignition': {
                'en': 'Ignite',
                'zh': '點火'
            },
            'altitude': {
                'en': 'Time',
                'zh': '時間'
            },
            'mission-complete-title': {
                'en': 'Mission Complete!',
                'zh': '任務完成！'
            },
            'mission-complete-text': {
                'en': 'Chang\'e-6 has successfully entered orbit',
                'zh': '嫦娥六號成功進入軌道'
            },
            'restart': {
                'en': 'Restart',
                'zh': '重新開始'
            },
            'mission-failed-title': {
                'en': 'Mission Failed!',
                'zh': '任務失敗！'
            },
            'mission-failed-text': {
                'en': 'Failed to complete separation at the correct altitude',
                'zh': '未能在正確的高度完成分離操作'
            }
        };
        
        // 创建飞行指示器（流星效果）
        function createFlightIndicator() {
            // 清空之前的星星
            flightIndicator.innerHTML = '';
            
            // 创建20颗星星
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // 随机位置和延迟
                const left = Math.random() * 100;
                const delay = Math.random() * 3;
                const size = Math.random() * 2 + 1;
                
                star.style.left = `${left}%`;
                star.style.animationDelay = `${delay}s`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                flightIndicator.appendChild(star);
            }
            
            flightIndicator.classList.add('active');
        }
        
        // 隐藏所有可交互区域
        function hideAllClickableAreas() {
            allClickableAreas.forEach(area => {
                area.classList.remove('active');
            });
        }
        
        // 根据当前步骤激活相应的可交互区域
        function updateClickableAreas() {
            hideAllClickableAreas();
            const currentTime = gameState.missionTime;
            const timeLimits = gameState.timeLimits;
            
            // 根据当前步骤和时间激活相应的可交互区域
            if (gameState.currentStep === 2 && currentTime >= timeLimits.boosterSeparation) {
                boosterClickLeft.classList.add('active');
                boosterClickRight.classList.add('active');
                boosterClickLeft.style.pointerEvents = 'auto';
                boosterClickRight.style.pointerEvents = 'auto';
                boosterClickLeft.style.cursor = 'pointer';
                boosterClickRight.style.cursor = 'pointer';
            } else if (gameState.currentStep === 3 && currentTime >= timeLimits.fairingSeparation) {
                fairingClickArea.classList.add('active');
                fairingClickArea.style.pointerEvents = 'auto';
                fairingClickArea.style.cursor = 'pointer';
            } else if (gameState.currentStep === 4 && currentTime >= timeLimits.firstStageSeparation) {
                firstStageClickArea.classList.add('active');
                firstStageClickArea.style.pointerEvents = 'auto';
                firstStageClickArea.style.cursor = 'pointer';
            } else if (gameState.currentStep === 6 && currentTime >= timeLimits.spacecraftSeparation) {
                payloadClickArea.classList.add('active');
                payloadClickArea.style.pointerEvents = 'auto';
                payloadClickArea.style.cursor = 'pointer';
            }
        }
        
        // 记录每个任务的时间点
        const taskTimes = [
            0, // Ignition
            gameState.timeLimits.boosterSeparation,
            gameState.timeLimits.fairingSeparation,
            gameState.timeLimits.firstStageSeparation,
            gameState.timeLimits.secondStageIgnition,
            gameState.timeLimits.spacecraftSeparation
        ];
        
        function startMissionTimer() {
            if (gameState.intervalId) {
                clearInterval(gameState.intervalId);
            }
            let customSpeed = 3;
            const timerInterval = setInterval(() => {
                if (gameState.currentStep <= 6) {
                    // 星舰分离前单独加速
                    if (gameState.currentStep === 6) {
                        const prev = gameState.timeLimits.secondStageIgnition;
                        const next = gameState.timeLimits.spacecraftSeparation;
                        const remain = next - gameState.missionTime;
                        customSpeed = remain > 0 ? Math.max(remain / 3, 3) : 3;
                    } else {
                        customSpeed = 3;
                    }
                    gameState.missionTime += customSpeed;
                    const currentTime = parseFloat(gameState.missionTime.toFixed(1));
                    document.getElementById('altitude-value').textContent = currentTime + ' s';
                    checkMissionTimePoint(currentTime);
                    updatePromptText(); // 保证每次计时都刷新提示
                } else {
                    clearInterval(timerInterval);
                }
            }, 100);
            gameState.intervalId = timerInterval;
        }

        // 检查任务时间点
        function checkMissionTimePoint(currentTime) {
            const timeLimits = gameState.timeLimits;
            let shouldPause = false;

            switch(gameState.currentStep) {
                case 2: // 助推器分离
                    if (currentTime >= timeLimits.boosterSeparation) {
                        shouldPause = true;
                        updateClickableAreas();
                    }
                    break;
                case 3: // 整流罩分离
                    if (currentTime >= timeLimits.fairingSeparation) {
                        shouldPause = true;
                        updateClickableAreas();
                    }
                    break;
                case 4: // 一级火箭分离
                    if (currentTime >= timeLimits.firstStageSeparation) {
                        shouldPause = true;
                        updateClickableAreas();
                    }
                    break;
                case 5: // 二级火箭点火
                    if (currentTime >= timeLimits.secondStageIgnition) {
                        shouldPause = true;
                        updateClickableAreas();
                    }
                    break;
                case 6: // 航天器分离
                    if (currentTime >= timeLimits.spacecraftSeparation) {
                        shouldPause = true;
                        updateClickableAreas();
                    }
                    break;
            }

            if (shouldPause) {
                clearInterval(gameState.intervalId);
            }
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', () => {
            // 初始化点火按钮
            const ignitionButton = document.querySelector('.ignition-button');
            if (ignitionButton) {
                ignitionButton.addEventListener('click', () => {
                    if (gameState.currentStep === 1) {
                        startCountdown();
                    }
                });
            }

            // 初始化重启按钮
            document.querySelectorAll('.restart-button').forEach(button => {
                button.addEventListener('click', () => {
                    location.reload();
                });
            });

            // 初始化助推器点击事件
            const boosterClickLeft = document.getElementById('booster-click-left');
            const boosterClickRight = document.getElementById('booster-click-right');
            if (boosterClickLeft && boosterClickRight) {
                boosterClickLeft.addEventListener('click', () => {
                    if (gameState.currentStep === 2 && gameState.missionTime >= gameState.timeLimits.boosterSeparation) {
                        detachAllBoosters();
                    }
                });
                boosterClickRight.addEventListener('click', () => {
                    if (gameState.currentStep === 2 && gameState.missionTime >= gameState.timeLimits.boosterSeparation) {
                        detachAllBoosters();
                    }
                });
            }

            // 初始化整流罩点击事件
            const fairingClickArea = document.getElementById('fairing-click');
            if (fairingClickArea) {
                fairingClickArea.addEventListener('click', () => {
                    if (gameState.currentStep === 3 && gameState.missionTime >= gameState.timeLimits.fairingSeparation) {
                        detachFairings();
                    }
                });
            }

            // 初始化一级火箭点击事件
            const firstStageClickArea = document.getElementById('first-stage-click');
            if (firstStageClickArea) {
                firstStageClickArea.addEventListener('click', () => {
                    if (gameState.currentStep === 4 && gameState.missionTime >= gameState.timeLimits.firstStageSeparation) {
                        firstStageDetach();
                    }
                });
            }

            // 初始化载荷点击事件
            const payloadClickArea = document.getElementById('payload-click');
            if (payloadClickArea) {
                payloadClickArea.addEventListener('click', () => {
                    if (gameState.currentStep === 6 && gameState.missionTime >= gameState.timeLimits.spacecraftSeparation) {
                        payloadSeparate();
                    }
                });
            }

            // 初始化语言
            updateLanguage();
        });
        
        // 更新语言
        function updateLanguage() {
            const lang = gameState.language === 'zh-tw' || gameState.language === 'zh' ? 'zh' : 'en';
            
            // 更新 document 语言
            document.documentElement.lang = gameState.language;
            
            // 更新所有步骤文本
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.textContent = texts[`step-${index + 1}`][lang];
            });
            
            // 更新提示文本
            updatePromptText();
            
            // 更新时间标签
            document.getElementById('altitude-label').textContent = texts['altitude'][lang] + ': ';
            
            // 更新任务完成对话框
            const missionComplete = document.querySelector('.mission-complete');
            if (missionComplete) {
                missionComplete.querySelector('h2').textContent = texts['mission-complete-title'][lang];
                missionComplete.querySelector('p').textContent = texts['mission-complete-text'][lang];
                missionComplete.querySelector('.restart-button').textContent = texts['restart'][lang];
            }

            // 更新任务失败对话框
            const missionFailed = document.querySelector('.mission-failed');
            if (missionFailed) {
                missionFailed.querySelector('h2').textContent = texts['mission-failed-title'][lang];
                missionFailed.querySelector('p').textContent = texts['mission-failed-text'][lang];
                missionFailed.querySelector('.restart-button').textContent = texts['restart'][lang];
            }
            
            // 更新点火按钮
            const ignitionButton = document.querySelector('.ignition-button');
            if (ignitionButton && gameState.currentStep === 1) {
                ignitionButton.textContent = texts['ignition'][lang];
            }
        }
        
        function updatePromptText() {
            // 每个任务开始前都显示提示
            let lang = gameState.language;
            if (lang === 'zh-tw') lang = 'zh';
            else if (lang !== 'zh') lang = 'en';
            const taskTime = taskTimes[gameState.currentStep - 1] || 0;
            // 只在剩余1秒内显示整个对话框，否则隐藏
            if (gameState.missionTime >= taskTime - 1 && gameState.missionTime < taskTime + 3) {
                promptContainer.style.display = 'block';
                promptText.textContent = texts[`prompt-${gameState.currentStep}`][lang];
                if (gameState.currentStep === 1) {
                    ignitionButton.textContent = texts['ignition'][lang];
                    ignitionButton.style.display = 'inline-block';
                } else {
                    ignitionButton.style.display = 'none';
                }
            } else {
                promptContainer.style.display = 'none';
                promptText.textContent = '';
                ignitionButton.style.display = 'none';
            }
        }
        
        // 语言同步优化
        let languageInitialized = false;
        function applyInitialLanguage(lang) {
            gameState.language = lang;
            document.documentElement.lang = lang;
            updateLanguage();
            updatePromptText();
            languageInitialized = true;
        }
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'setLanguage') {
                applyInitialLanguage(event.data.lang);
            } else if (event.data && event.data.type === 'requestLanguage') {
                event.source.postMessage({ 
                    type: 'setLanguage', 
                    lang: gameState.language === 'zh-tw' ? 'zh' : gameState.language 
                }, '*');
            }
        });
        // 页面加载时请求父页面发送当前语言，收到后再渲染UI
        window.addEventListener('DOMContentLoaded', () => {
            window.parent.postMessage({ type: 'requestLanguage' }, '*');
            setTimeout(() => {
                if (!languageInitialized) {
                    applyInitialLanguage(document.documentElement.lang || 'en');
                }
            }, 1000);
        });
        
        // 点火和发射
        function startCountdown() {
            gameState.countdown = true;
            countdown.classList.add('visible');
            
            // 速度更快的倒计时
            gameState.countdownValue = 3; // 减少到3秒
            countdown.textContent = gameState.countdownValue;
            
            gameState.intervalId = setInterval(() => {
                gameState.countdownValue--;
                countdown.textContent = gameState.countdownValue;
                
                if (gameState.countdownValue <= 0) {
                    clearInterval(gameState.intervalId);
                    setTimeout(() => {
                        countdown.classList.remove('visible');
                        startLaunch();
                    }, 500); // 加快倒计时结束后的延迟
                }
            }, 800); // 加快倒计时速度
        }
        
        function startLaunch() {
            // 激活所有一级火箭和助推器引擎
            firstStageEngines.forEach(engine => {
                engine.classList.add('ignited');
            });
            
            firstStageFlame.classList.add('active');
            
            boosterFlames.forEach(flame => {
                flame.classList.add('active');
            });
            
            // 开始火箭上升
            rocketContainer.style.transform = 'translateY(-120vh)';
            rocket.style.bottom = '0';
            earthBackdrop.classList.add('fade-away');
            
            gameState.rocketLaunched = true;
            
            // 更新游戏状态
            completeStep(1);
            
            // 切换到飞行模式
            setTimeout(() => {
                switchToFlightMode();
            }, 1500);

            // 开始任务计时器
            startMissionTimer();
            // 播放点火音效
            if (audioIgnition) {
                audioIgnition.currentTime = 0;
                audioIgnition.play().catch((e) => {console.log('Ignition audio error', e);});
            }
            // 延迟播放飞行音效
            setTimeout(() => {
                if (audioFlight) {
                    audioFlight.currentTime = 0;
                    audioFlight.play().catch((e) => {console.log('Flight audio error', e);});
                }
            }, 1200);
        }
        
        // 切换到飞行模式
        function switchToFlightMode() {
            // 激活场景过渡
            sceneTransition.classList.add('active');
            
            setTimeout(() => {
                // 重置火箭位置到屏幕中央
                rocketContainer.style.transition = 'none';
                rocketContainer.style.transform = 'translateY(0)';
                rocket.style.bottom = '50%';
                rocket.style.transform = 'rotateX(-10deg) translateY(50%)';
                
                // 创建飞行效果
                createFlightIndicator();
                
                // 淡出过渡 - 加快速度
                setTimeout(() => {
                    sceneTransition.classList.remove('active');
                    gameState.flightMode = true;
                    
                    // 加快恢复过渡效果
                    setTimeout(() => {
                        rocketContainer.style.transition = 'transform 2.5s ease-out'; // 更快的过渡
                        
                        // 进入下一步
                        advanceToStep(2);
                        
                        // 更新可交互区域
                        updateClickableAreas();
                    }, 300); // 从500ms减少到300ms
                }, 500); // 从1000ms减少到500ms
            }, 500); // 从1000ms减少到500ms
        }
        
        // 分离所有助推器
        function detachAllBoosters() {
            boosters[0].classList.add('detached-left-front');
            boosters[1].classList.add('detached-right-front');
            boosters[2].classList.add('detached-left-back');
            boosters[3].classList.add('detached-right-back');
            
            // 隐藏助推器的可交互区域
            boosterClickLeft.classList.remove('active');
            boosterClickRight.classList.remove('active');
            
            completeStep(2);
            advanceToStep(3);
        }
        
        // 助推器分离事件
        boosterClickLeft.addEventListener('click', () => {
            if (gameState.currentStep === 2 && gameState.missionTime >= gameState.timeLimits.boosterSeparation) {
                detachAllBoosters();
            }
        });
        
        boosterClickRight.addEventListener('click', () => {
            if (gameState.currentStep === 2 && gameState.missionTime >= gameState.timeLimits.boosterSeparation) {
                detachAllBoosters();
            }
        });
        
        // 整流罩分离事件
        fairingClickArea.addEventListener('click', () => {
            if (gameState.currentStep === 3 && gameState.missionTime >= gameState.timeLimits.fairingSeparation) {
                detachFairings();
            }
        });
        
        function detachFairings() {
            fairingLeft.classList.add('detached-left');
            fairingRight.classList.add('detached-right');
            payload.classList.add('visible');
            
            // 隐藏整流罩的可交互区域
            fairingClickArea.classList.remove('active');
            
            completeStep(3);
            advanceToStep(4);
        }
        
        // 一级火箭分离事件
        firstStageClickArea.addEventListener('click', () => {
            if (gameState.currentStep === 4 && gameState.missionTime >= gameState.timeLimits.firstStageSeparation) {
                firstStageDetach();
            }
        });
        
        function firstStageDetach() {
            firstStage.classList.add('detached');
            firstStageFlame.classList.remove('active');
            
            // 隐藏一级火箭的可交互区域
            firstStageClickArea.classList.remove('active');
            
            completeStep(4);
            
            // 自动进入二级火箭点火阶段 - 加快速度
            setTimeout(() => {
                secondStageIgnite();
            }, 1000); // 从2000ms减少到1000ms
        }
        
        // 二级火箭自动点火
        function secondStageIgnite() {
            advanceToStep(5);
            
            // 激活二级火箭引擎
            secondStageEngines.forEach(engine => {
                engine.classList.add('ignited');
                engine.style.opacity = '1';
            });
            
            // 添加二级火箭火焰
            const secondStageFlame = document.createElement('div');
            secondStageFlame.className = 'flame active';
            secondStage.appendChild(secondStageFlame);
            
            // 显示一段时间后进入下一步 - 加快速度
            setTimeout(() => {
                completeStep(5);
                advanceToStep(6);
                
                // 更新可交互区域
                updateClickableAreas();
            }, 1500); // 从3000ms减少到1500ms
        }
        
        // 星箭分离事件
        payloadClickArea.addEventListener('click', () => {
            if (gameState.currentStep === 6 && gameState.missionTime >= gameState.timeLimits.spacecraftSeparation) {
                payloadSeparate();
            }
        });
        
        function payloadSeparate() {
            payload.classList.add('separated');
            
            // 隐藏载荷的可交互区域
            payloadClickArea.classList.remove('active');
            
            setTimeout(() => {
                // 场景切换到嫦娥六号特写
                switchToSpacecraftFocus();
            }, 1000); // 从1500ms减少到1000ms
        }
        
        // 切换到嫦娥六号特写
        function switchToSpacecraftFocus() {
            // 激活场景过渡
            sceneTransition.classList.add('active');
            
            setTimeout(() => {
                // 隐藏火箭
                rocketContainer.style.opacity = '0';
                
                setTimeout(() => {
                    // 显示嫦娥六号特写
                    spacecraftFocus.classList.add('visible');
                    
                    // 淡出过渡
                    setTimeout(() => {
                        sceneTransition.classList.remove('active');
                        
                        // 完成最后一步
                        completeStep(6);
                        
                        // 延迟显示任务完成
                        setTimeout(() => {
                            showMissionComplete();
                        }, 1000); // 从2000ms减少到1000ms
                    }, 500); // 从1000ms减少到500ms
                }, 300); // 从500ms减少到300ms
            }, 500); // 从1000ms减少到500ms
        }
        
        // 更新游戏步骤
        function completeStep(step) {
            const stepElement = document.querySelector(`.step-${step}`);
            stepElement.classList.remove('active');
            stepElement.classList.add('completed');
            
            // 重新启动计时器，但不重置时间
            if (step < 6) {
                startMissionTimer();
            }
        }
        
        function advanceToStep(step) {
            gameState.currentStep = step;
            const stepElement = document.querySelector(`.step-${step}`);
            stepElement.classList.add('active');
            
            updatePromptText();
            
            // 如果是第一次进入步骤2，开始高度更新
            if (step === 2 && gameState.altitude === 0) {
                startMissionTimer();
            }
            
            // 更新可交互区域
            updateClickableAreas();
        }
        
        // 显示任务完成
        function showMissionComplete() {
            missionComplete.style.display = 'block';
            if (audioFlight) audioFlight.pause();
            if (audioFlight) audioFlight.currentTime = 0;
        }

        // 音效元素
        const audioIgnition = document.getElementById('audio-ignition');
        const audioFlight = document.getElementById('audio-flight');
        // 兼容自动播放策略，首次用户交互后允许播放
        function enableAudioPlayback() {
            if (audioIgnition) audioIgnition.load();
            if (audioFlight) audioFlight.load();
            if (audioIgnition) audioIgnition.play().catch(() => {});
            if (audioFlight) audioFlight.play().catch(() => {});
            if (audioIgnition) audioIgnition.pause();
            if (audioFlight) audioFlight.pause();
            window.removeEventListener('click', enableAudioPlayback);
        }
        window.addEventListener('click', enableAudioPlayback);
    </script>
</body>
</html>
